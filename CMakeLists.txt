cmake_minimum_required(VERSION 3.29)
project(testare_vtune)

set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -g")

add_executable(testare_vtune doamne.cpp)

#add_custom_command(TARGET testare_vtune POST_BUILD
#        COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_${CMAKE_BUILD_TYPE}
#        COMMAND "C:/Program Files (x86)/Intel/oneAPI/vtune/latest/bin64/vtune.exe"
#        --collect hotspots
#        --collect memory-access
#        --result-dir ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_${CMAKE_BUILD_TYPE}
#        --report hotspots  # Folosind acest raport pentru detalii de performanÈ›Äƒ
#        --report-output ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_${CMAKE_BUILD_TYPE}/hotspots_report.txt
#        -- ./testare_vtune.exe
#        COMMENT "Running VTune profiler (hotspots, memory-access) and generating report"
#)


add_custom_command(TARGET testare_vtune POST_BUILD
        # ðŸ”„ È˜terge directoarele de rezultate anterioare
        COMMAND ${CMAKE_COMMAND} -E remove_directory ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_/hotspots
        COMMAND ${CMAKE_COMMAND} -E remove_directory ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_/memory

        # ðŸ“ CreeazÄƒ din nou directoarele goale
        COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_/hotspots
        COMMAND ${CMAKE_COMMAND} -E make_directory ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_/memory

        # ðŸŸ¥ Colectare HOTSPOTS cu redirecÈ›ionare output
        COMMAND cmd /c "\"C:/Program Files (x86)/Intel/oneAPI/vtune/latest/bin64/vtune.exe\" -collect hotspots -result-dir ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_/hotspots -- ${CMAKE_CURRENT_BINARY_DIR}/Debug/testare_vtune.exe >nul 2>nul"

        # ðŸ“Š Raport HOTSPOTS â€” output doar Ã®n fiÈ™ier
        COMMAND cmd /c "\"C:/Program Files (x86)/Intel/oneAPI/vtune/latest/bin64/vtune.exe\" -report hotspots -result-dir ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_/hotspots -report-output ${CMAKE_CURRENT_BINARY_DIR}/vtune_results_/hotspots_report.txt >nul 2>nul"

        COMMENT "Running VTune profiler (hotspots only) silently and saving report to file"
)



